<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Waves Beat Music</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    body { font-family: 'Inter', sans-serif; background: linear-gradient(to bottom right, #000, #111, #1a1a1a); color: white; }
    .spotify-green { color: #1DB954; }
    .spotify-bg { background-color: #1DB954; }
    .glass { background: rgba(40,40,40,0.7); backdrop-filter: blur(16px); border: 1px solid rgba(255,255,255,0.08); }
    .song-hover:hover { transform: translateY(-4px); background: rgba(255,255,255,0.05); }
  </style>
</head>
<body class="min-h-screen pb-32">

<div class="flex h-screen">
  <!-- Sidebar -->
  <aside class="w-72 bg-black/90 border-r border-gray-800 flex flex-col">
    <div class="p-6 flex items-center gap-3">
      <div class="w-10 h-10 spotify-bg rounded-xl flex-center text-2xl">ðŸŒŠ</div>
      <h1 class="text-2xl font-bold">Waves Beat</h1>
    </div>
    <nav class="flex-1 px-3 py-6 space-y-1">
      <button onclick="showPage('home')" class="nav-item w-full text-left px-4 py-3 rounded-xl flex items-center gap-3 active">
        <i class="fa-solid fa-house"></i> Home
      </button>
      <button onclick="showPage('library')" class="nav-item w-full text-left px-4 py-3 rounded-xl flex items-center gap-3">
        <i class="fa-solid fa-music"></i> Library
      </button>
      <button onclick="showPage('playlists')" class="nav-item w-full text-left px-4 py-3 rounded-xl flex items-center gap-3">
        <i class="fa-solid fa-list"></i> Playlists
      </button>
      <button onclick="openUpload()" class="nav-item w-full text-left px-4 py-3 rounded-xl flex items-center gap-3 mt-6 spotify-green">
        <i class="fa-solid fa-cloud-arrow-up"></i> Upload Song
      </button>
    </nav>
    <div class="p-6 border-t border-gray-800 flex items-center gap-3 cursor-pointer" onclick="openLogin()">
      <div class="w-10 h-10 rounded-full spotify-bg flex-center">ðŸ‘¤</div>
      <div>
        <div id="userName" class="font-medium">Guest</div>
        <div class="text-xs text-gray-400 cursor-pointer" onclick="event.stopPropagation(); logout()">Logout</div>
      </div>
    </div>
  </aside>

  <!-- Main -->
  <main class="flex-1 overflow-y-auto">
    <header class="sticky top-0 z-10 glass px-8 py-4 flex justify-between items-center backdrop-blur-md">
      <div class="flex items-center gap-4">
        <input id="search" oninput="filterSongs()" type="text" placeholder="Search songs..." class="bg-gray-900 border border-gray-700 rounded-full px-5 py-2.5 w-80 focus:outline-none focus:border-[#1DB954]"/>
      </div>
      <div class="flex items-center gap-6">
        <button onclick="toggleTheme()" class="text-xl"><i id="themeIcon" class="fa-solid fa-moon"></i></button>
      </div>
    </header>

    <div id="home" class="p-8">
      <h1 class="text-4xl font-bold mb-2">Good evening, <span id="greetName" class="spotify-green">Guest</span></h1>
      <section class="my-10">
        <h2 class="text-2xl font-semibold mb-4">Recently Played</h2>
        <div id="recent" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4"></div>
      </section>
      <section>
        <h2 class="text-2xl font-semibold mb-4">Popular Tracks</h2>
        <div id="popular" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4"></div>
      </section>
    </div>

    <div id="library" class="p-8 hidden">
      <h1 class="text-4xl font-bold mb-6">Your Library</h1>
      <div id="libList" class="space-y-2"></div>
    </div>

    <div id="playlists" class="p-8 hidden">
      <div class="flex justify-between mb-6">
        <h1 class="text-4xl font-bold">Playlists</h1>
        <button onclick="createPlaylist()" class="spotify-bg px-6 py-2.5 rounded-full font-medium flex items-center gap-2">
          <i class="fa-solid fa-plus"></i> New
        </button>
      </div>
      <div id="plistGrid" class="grid grid-cols-3 md:grid-cols-5 gap-6"></div>
    </div>
  </main>
</div>

<!-- Bottom Player -->
<div class="fixed bottom-0 left-0 right-0 h-24 glass border-t border-gray-800 flex items-center px-6 z-50">
  <div class="flex items-center gap-4 w-72">
    <img id="nowCover" src="https://picsum.photos/80" class="w-14 h-14 rounded-lg object-cover" alt="cover">
    <div class="min-w-0">
      <div id="nowTitle" class="font-medium truncate">Not playing</div>
      <div id="nowArtist" class="text-sm text-gray-400 truncate">â€”</div>
    </div>
  </div>

  <div class="flex-1 flex flex-col items-center gap-1">
    <div class="flex items-center gap-6 text-xl">
      <button id="shuffleBtn" onclick="toggleShuffle()" class="hover:spotify-green"><i class="fa-solid fa-shuffle"></i></button>
      <button onclick="prev()"><i class="fa-solid fa-backward-step"></i></button>
      <button id="playPause" onclick="toggle()" class="w-14 h-14 spotify-bg rounded-full flex-center text-2xl shadow-lg hover:scale-105">
        <i class="fa-solid fa-play"></i>
      </button>
      <button onclick="next()"><i class="fa-solid fa-forward-step"></i></button>
      <button id="repeatBtn" onclick="toggleRepeat()" class="hover:spotify-green"><i class="fa-solid fa-repeat"></i></button>
    </div>
    <div class="w-full max-w-xl flex items-center gap-3 text-xs">
      <span id="currTime">0:00</span>
      <input id="seek" type="range" min="0" max="100" value="0" class="flex-1 accent-[#1DB954]" oninput="seekTo()"/>
      <span id="durTime">0:00</span>
    </div>
  </div>

  <div class="flex items-center gap-4 w-72 justify-end">
    <button onclick="openViz()" class="text-xl hover:spotify-green"><i class="fa-solid fa-waveform"></i></button>
    <input id="vol" type="range" min="0" max="1" step="0.01" value="0.8" class="w-24 accent-[#1DB954]" oninput="setVol()"/>
  </div>
</div>

<!-- Modals -->
<div id="uploadModal" class="hidden fixed inset-0 bg-black/80 flex-center z-50">
  <div class="glass p-10 rounded-2xl w-full max-w-md text-center">
    <h2 class="text-2xl font-bold mb-6">Upload Song</h2>
    <input id="filePick" type="file" accept="audio/*" class="hidden" onchange="uploadFiles(event)"/>
    <button onclick="document.getElementById('filePick').click()" class="w-full py-16 border-2 border-dashed border-[#1DB954]/50 rounded-xl hover:border-[#1DB954]">
      <i class="fa-solid fa-cloud-arrow-up text-6xl spotify-green mb-4"></i>
      <p class="font-medium">Click or drop files here</p>
    </button>
    <button onclick="closeUpload()" class="mt-6 text-gray-400">Cancel</button>
  </div>
</div>

<div id="loginModal" class="hidden fixed inset-0 bg-black/80 flex-center z-50">
  <div class="glass p-10 rounded-2xl w-full max-w-sm">
    <h2 class="text-2xl font-bold mb-6 text-center">Sign in</h2>
    <input id="uname" type="text" placeholder="Your name" class="w-full bg-gray-900 border border-gray-700 rounded-full py-4 px-6 text-center focus:outline-none focus:border-[#1DB954]"/>
    <button onclick="signIn()" class="mt-6 w-full spotify-bg py-4 rounded-full font-bold">Continue</button>
  </div>
</div>

<div id="vizModal" class="hidden fixed inset-0 bg-black/95 flex-center z-50">
  <div>
    <canvas id="vizCanvas" width="800" height="400" class="rounded-xl shadow-2xl"></canvas>
    <button onclick="closeViz()" class="mt-6 px-10 py-4 bg-gray-800 rounded-full">Close</button>
  </div>
</div>

<audio id="playerAudio"></audio>

<script>
const audio = document.getElementById('playerAudio');
let ctx, source, analyser, dataArr, vizRunning = false;
let songs = [], current = -1, shuffleOn = false, repeat = 'off';
let username = localStorage.getItem('wbUser') || 'Guest';
let dark = localStorage.getItem('wbTheme') !== 'light';

document.getElementById('userName').textContent = username;
document.getElementById('greetName').textContent = username;

const sampleSongs = [
  {id:1, title:"Track One", artist:"SoundHelix", src:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3", cover:"https://picsum.photos/seed/1/300"},
  {id:2, title:"Track Two", artist:"SoundHelix", src:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3", cover:"https://picsum.photos/seed/2/300"},
  {id:3, title:"Track Three", artist:"SoundHelix", src:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3", cover:"https://picsum.photos/seed/3/300"},
  {id:4, title:"Track Four", artist:"SoundHelix", src:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3", cover:"https://picsum.photos/seed/4/300"},
];

songs = [...sampleSongs];

function initAudioCtx() {
  if (!ctx) {
    ctx = new (window.AudioContext || window.webkitAudioContext)();
    analyser = ctx.createAnalyser();
    analyser.fftSize = 128;
    dataArr = new Uint8Array(analyser.frequencyBinCount);
  }
}

function connectSource() {
  if (source) source.disconnect();
  source = ctx.createMediaElementSource(audio);
  source.connect(analyser);
  analyser.connect(ctx.destination);
}

function drawViz() {
  if (!vizRunning || audio.paused) return;
  requestAnimationFrame(drawViz);
  analyser.getByteFrequencyData(dataArr);
  const canvas = document.getElementById('vizCanvas');
  const c = canvas.getContext('2d');
  c.clearRect(0, 0, canvas.width, canvas.height);
  const barW = canvas.width / dataArr.length * 2.5;
  let x = 0;
  for (let i = 0; i < dataArr.length; i++) {
    const h = (dataArr[i] / 255) * canvas.height * 0.8;
    c.fillStyle = `hsl(${i * 3}, 100%, 60%)`;
    c.fillRect(x, canvas.height - h, barW, h);
    x += barW + 3;
  }
}

function play(idx) {
  if (idx < 0 || idx >= songs.length) return;
  current = idx;
  const s = songs[idx];
  audio.src = s.src;
  audio.play().catch(e => console.log("Play error:", e));
  document.getElementById('playPause').innerHTML = '<i class="fa-solid fa-pause"></i>';
  document.getElementById('nowCover').src = s.cover;
  document.getElementById('nowTitle').textContent = s.title;
  document.getElementById('nowArtist').textContent = s.artist;
  initAudioCtx();
  ctx.resume().then(() => {
    connectSource();
    vizRunning = true;
    drawViz();
  });
}

function toggle() {
  if (audio.paused) {
    audio.play();
    document.getElementById('playPause').innerHTML = '<i class="fa-solid fa-pause"></i>';
    ctx?.resume();
    vizRunning = true;
    drawViz();
  } else {
    audio.pause();
    document.getElementById('playPause').innerHTML = '<i class="fa-solid fa-play"></i>';
    vizRunning = false;
  }
}

audio.ontimeupdate = () => {
  if (!audio.duration) return;
  document.getElementById('seek').value = (audio.currentTime / audio.duration) * 100;
  document.getElementById('currTime').textContent = format(audio.currentTime);
  document.getElementById('durTime').textContent = format(audio.duration);
};

audio.onended = () => {
  if (repeat === 'one') {
    audio.currentTime = 0;
    audio.play();
  } else {
    next();
  }
};

function seekTo() {
  audio.currentTime = (document.getElementById('seek').value / 100) * audio.duration;
}

function setVol() {
  audio.volume = document.getElementById('vol').value;
}

function format(t) {
  const m = Math.floor(t / 60);
  const s = Math.floor(t % 60);
  return `${m}:${s.toString().padStart(2,'0')}`;
}

function next() { play(current + 1 >= songs.length ? 0 : current + 1); }
function prev() { play(current - 1 < 0 ? songs.length - 1 : current - 1); }

function toggleShuffle() {
  shuffleOn = !shuffleOn;
  document.getElementById('shuffleBtn').classList.toggle('spotify-green', shuffleOn);
}

function toggleRepeat() {
  if (repeat === 'off') { repeat = 'all'; document.getElementById('repeatBtn').classList.add('spotify-green'); }
  else if (repeat === 'all') { repeat = 'one'; document.getElementById('repeatBtn').innerHTML = '<i class="fa-solid fa-repeat"></i><sup class="text-xs">1</sup>'; }
  else { repeat = 'off'; document.getElementById('repeatBtn').innerHTML = '<i class="fa-solid fa-repeat"></i>'; document.getElementById('repeatBtn').classList.remove('spotify-green'); }
}

function uploadFiles(e) {
  [...e.target.files].forEach(file => {
    const url = URL.createObjectURL(file);
    const temp = new Audio(url);
    temp.onloadedmetadata = () => {
      songs.push({
        id: Date.now(),
        title: file.name.replace(/\.[^/.]+$/, ""),
        artist: "Local",
        src: url,
        cover: "https://picsum.photos/seed/local/300"
      });
      renderAll();
      closeUpload();
      play(songs.length - 1);
    };
  });
}

function renderAll() {
  render('recent', songs.slice(0,6));
  render('popular', songs);
  renderLib();
  // playlists can be added later
}

function render(id, list) {
  const cont = document.getElementById(id);
  cont.innerHTML = '';
  list.forEach((s, i) => {
    const card = document.createElement('div');
    card.className = 'song-hover bg-gray-900/50 rounded-xl overflow-hidden cursor-pointer';
    card.innerHTML = `
      <img src="${s.cover}" class="w-full aspect-square object-cover">
      <div class="p-3">
        <div class="font-medium truncate">${s.title}</div>
        <div class="text-sm text-gray-400">${s.artist}</div>
      </div>
    `;
    card.onclick = () => play(i);
    cont.appendChild(card);
  });
}

function renderLib() {
  const cont = document.getElementById('libList');
  cont.innerHTML = '';
  songs.forEach((s, i) => {
    const row = document.createElement('div');
    row.className = 'flex items-center gap-4 p-3 hover:bg-gray-800/50 rounded-xl cursor-pointer';
    row.innerHTML = `
      <img src="${s.cover}" class="w-12 h-12 rounded-md">
      <div class="flex-1">
        <div>${s.title}</div>
        <div class="text-sm text-gray-400">${s.artist}</div>
      </div>
      <button onclick="event.stopPropagation(); play(${i})" class="spotify-bg px-5 py-1.5 rounded-full text-sm">Play</button>
    `;
    row.onclick = () => play(i);
    cont.appendChild(row);
  });
}

function filterSongs() {
  const term = document.getElementById('search').value.toLowerCase();
  // simple filter - can improve
  render('popular', songs.filter(s => s.title.toLowerCase().includes(term) || s.artist.toLowerCase().includes(term)));
}

function showPage(page) {
  document.querySelectorAll('#home,#library,#playlists').forEach(el => el.classList.add('hidden'));
  document.getElementById(page).classList.remove('hidden');
  document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
  event.target.classList.add('active');
}

function openUpload() { document.getElementById('uploadModal').classList.remove('hidden'); }
function closeUpload() { document.getElementById('uploadModal').classList.add('hidden'); }

function openLogin() { document.getElementById('loginModal').classList.remove('hidden'); }
function signIn() {
  username = document.getElementById('uname').value.trim() || 'Guest';
  localStorage.setItem('wbUser', username);
  document.getElementById('userName').textContent = username;
  document.getElementById('greetName').textContent = username;
  document.getElementById('loginModal').classList.add('hidden');
}
function logout() {
  if (confirm('Logout?')) {
    localStorage.removeItem('wbUser');
    username = 'Guest';
    document.getElementById('userName').textContent = 'Guest';
    document.getElementById('greetName').textContent = 'Guest';
  }
}

function toggleTheme() {
  dark = !dark;
  document.documentElement.classList.toggle('dark', dark);
  document.getElementById('themeIcon').classList.toggle('fa-moon', dark);
  document.getElementById('themeIcon').classList.toggle('fa-sun', !dark);
  localStorage.setItem('wbTheme', dark ? 'dark' : 'light');
}

function openViz() { document.getElementById('vizModal').classList.remove('hidden'); if (!audio.paused) { vizRunning = true; drawViz(); } }
function closeViz() { document.getElementById('vizModal').classList.add('hidden'); vizRunning = false; }

function createPlaylist() { alert('Playlist feature coming soon with backend!'); }

// Start
renderAll();
showPage('home');

// First play needs user gesture - so play button handles resume
</script>
</body>
</html>
